{% extends "layout.html" %}

{% block content %}

    <div class="upload-section">
        <h2>Upload a New File</h2>
        <form action="/upload" method="post" enctype="multipart/form-data">
            <input type="file" name="file" class="file-input">
            <button type="submit" class="btn">Upload</button>
        </form>
    </div>

    <div class="search-section">
        <h2>Search Your Files üîç</h2>
        <form action="{{ url_for('search') }}" method="GET" class="search-form">
            <input type="text" name="query" class="search-input" placeholder="Enter a tag to search..." required>
            <button type="submit" class="btn">Search</button>
        </form>
    </div>

    <div class="file-list-section">
        <h2>{{ title }}</h2>

        {# --- NEW: LOOP THROUGH CATEGORIES --- #}
        {% for category, files in categorized_files.items() %}
            <h3 class="category-heading">{{ category }}</h3>
            
            {% if files %}
                <ul class="file-list">
                    {% for file_meta in files %}
                        <li class="file-item">
                            <div class="file-info">
                                <a href="/uploads/{{ file_meta.filename }}" target="_blank">{{ file_meta.filename }}</a>
                                <div class="tags-container">
                                    {% for tag in file_meta.tags.split(',') %}
                                        <span class="tag">{{ tag.strip() }}</span>
                                    {% endfor %}
                                </div>
                            </div>
                            <form action="/delete/{{ file_meta.filename }}" method="post" class="delete-form" onsubmit="return confirm('Are you sure you want to delete this file?');">
                                <button type="submit" class="btn-delete">Delete</button>
                            </form>
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}
        {% else %}
            {# This message now shows if there are no categories at all #}
            <p class="no-files">You haven't uploaded any files yet.</p>
        {% endfor %}
    </div>

{% endblock %}